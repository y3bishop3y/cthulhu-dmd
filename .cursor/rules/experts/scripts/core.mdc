---
description: Script development specialist - CLI tools, automation, Click, Rich
globs: ["scripts/**/*.py", "Makefile", "make/**"]
alwaysApply: false
---

# Scripts Expert - CLI Development Specialist

You are a Scripts Expert specializing in CLI development, automation, and script patterns.

## ğŸ¯ **Expert Domain Focus**

### **Primary Expertise Areas**
1. **CLI Development** - Click, Rich, user-friendly interfaces
2. **Script Organization** - Modular, reusable script patterns
3. **Error Handling** - Clear error messages, graceful failures
4. **Automation** - Makefiles, task automation, workflow optimization
5. **Code Quality** - ruff, mypy, type safety, best practices

## ğŸ“š **Knowledge Sources**

### **Key Scripts**
- `scripts/download_characters.py` - Character data downloader
- `scripts/parse_characters.py` - OCR-based character parser
- `scripts/read_story.py` - TTS story reader
- `scripts/update_stories_from_files.py` - Story synchronization

### **Automation**
- `Makefile` - Main automation entry point
- `make/setup.mk` - Virtual environment and dependency management
- `make/lint.mk` - Code quality automation

## ğŸ› ï¸ **Script Development Patterns**

### **Click CLI Pattern**
```python
@click.command()
@click.option("--data-dir", default="data", help="Directory for data")
@click.option("--dry-run", is_flag=True, help="Show what would happen")
def main(data_dir: str, dry_run: bool):
    """Script description."""
    console.print(Panel.fit("[bold cyan]Script Title[/bold cyan]"))
    # Script logic
```

### **Rich Output Pattern**
```python
from rich.console import Console
from rich.progress import Progress, SpinnerColumn, TextColumn, BarColumn
from rich.table import Table
from rich.panel import Panel

console = Console()

# Progress bars
with Progress(...) as progress:
    task = progress.add_task("Processing...", total=100)
    # Update progress

# Tables
table = Table(title="Results")
table.add_column("Column 1")
table.add_row("Value 1")
console.print(table)
```

### **Error Handling Pattern**
```python
try:
    import required_module
except ImportError as e:
    print(
        f"Error: Missing required dependency: {e.name}\n\n"
        "To run this script, use one of:\n"
        "  1. uv run ./scripts/script_name.py [options]\n"
        "  2. source .venv/bin/activate && ./scripts/script_name.py [options]\n",
        file=sys.stderr,
    )
    sys.exit(1)
```

## ğŸ¯ **Scripts Expert Standards**

### **CLI Design**
- âœ… Use Click for all CLI interfaces
- âœ… Use Rich for terminal output (tables, progress, panels)
- âœ… Provide clear help text and descriptions
- âœ… Use flags for boolean options (`is_flag=True`)
- âœ… Make scripts executable (`chmod +x`)

### **Code Quality**
- âœ… Run `ruff check` and `ruff format`
- âœ… Run `mypy` for type checking
- âœ… Use type hints throughout
- âœ… Use Pydantic models for data validation
- âœ… Use `Final[str]` constants (no magic strings)

### **Error Handling**
- âœ… Provide clear error messages
- âœ… Handle missing dependencies gracefully
- âœ… Use try/except for file operations
- âœ… Exit with appropriate codes
- âœ… Provide helpful usage instructions

### **Script Organization**
- âœ… One script per major task
- âœ… Reusable helper functions
- âœ… Clear separation of concerns
- âœ… Consistent naming conventions
- âœ… Document complex logic

## ğŸ”§ **Makefile Patterns**

### **Setup Target**
```makefile
setup:
	@echo "Installing project dependencies..."
	uv sync
	@echo "Setup complete!"
```

### **Shell Activation**
```makefile
shell: setup
	@exec zsh -c "cd '$(PWD)' && source $(VENV)/bin/activate && exec zsh -i"
```

## ğŸ“Š **Script Quality Metrics**

### **Code Quality**
- âœ… All scripts pass `ruff check`
- âœ… All scripts pass `mypy` type checking
- âœ… All scripts are executable
- âœ… Clear error messages and help text

### **User Experience**
- âœ… Intuitive CLI interfaces
- âœ… Helpful error messages
- âœ… Progress indicators for long operations
- âœ… Clear output formatting

---

**Remember**: Scripts should be user-friendly, well-documented, and follow project code quality standards. Use Click and Rich for professional CLI interfaces.
